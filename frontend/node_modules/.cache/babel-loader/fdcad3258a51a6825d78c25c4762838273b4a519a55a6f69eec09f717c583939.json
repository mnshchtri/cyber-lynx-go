{"ast":null,"code":"import warning from \"@rc-component/util/es/warning\";\nimport { useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport FieldContext, { HOOK_MARK } from \"./FieldContext\";\nimport { isFormInstance } from \"./utils/typeUtil\";\nimport { getNamePath, getValue } from \"./utils/valueUtil\";\nimport { useEvent } from '@rc-component/util';\nexport function stringify(value) {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return Math.random();\n  }\n}\n\n// ------- selector type -------\n\n// ------- selector type end -------\n\nfunction useWatch(...args) {\n  const [dependencies, _form = {}] = args;\n  const options = isFormInstance(_form) ? {\n    form: _form\n  } : _form;\n  const form = options.form;\n  const [value, setValue] = useState(() => typeof dependencies === 'function' ? dependencies({}) : undefined);\n  const valueStr = useMemo(() => stringify(value), [value]);\n  const valueStrRef = useRef(valueStr);\n  valueStrRef.current = valueStr;\n  const fieldContext = useContext(FieldContext);\n  const formInstance = form || fieldContext;\n  const isValidForm = formInstance && formInstance._init;\n\n  // Warning if not exist form instance\n  if (process.env.NODE_ENV !== 'production') {\n    warning(args.length === 2 ? form ? isValidForm : true : isValidForm, 'useWatch requires a form instance since it can not auto detect from context.');\n  }\n\n  // ============================== Form ==============================\n  const {\n    getFieldsValue,\n    getInternalHooks\n  } = formInstance;\n  const {\n    registerWatch\n  } = getInternalHooks(HOOK_MARK);\n\n  // ============================= Update =============================\n  const triggerUpdate = useEvent((values, allValues) => {\n    const watchValue = options.preserve ? allValues ?? getFieldsValue(true) : values ?? getFieldsValue();\n    const nextValue = typeof dependencies === 'function' ? dependencies(watchValue) : getValue(watchValue, getNamePath(dependencies));\n    if (stringify(value) !== stringify(nextValue)) {\n      setValue(nextValue);\n    }\n  });\n\n  // ============================= Effect =============================\n  const flattenDeps = typeof dependencies === 'function' ? dependencies : JSON.stringify(dependencies);\n\n  // Deps changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    triggerUpdate();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm, flattenDeps]);\n\n  // Value changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    const cancelRegister = registerWatch((values, allValues) => {\n      triggerUpdate(values, allValues);\n    });\n    return cancelRegister;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm]);\n  return value;\n}\nexport default useWatch;","map":{"version":3,"names":["warning","useContext","useEffect","useMemo","useRef","useState","FieldContext","HOOK_MARK","isFormInstance","getNamePath","getValue","useEvent","stringify","value","JSON","Math","random","useWatch","args","dependencies","_form","options","form","setValue","undefined","valueStr","valueStrRef","current","fieldContext","formInstance","isValidForm","_init","process","env","NODE_ENV","length","getFieldsValue","getInternalHooks","registerWatch","triggerUpdate","values","allValues","watchValue","preserve","nextValue","flattenDeps","cancelRegister"],"sources":["/Users/mnsh/Desktop/cyber-lynx/Cyber-LynX-php/frontend/node_modules/@rc-component/form/es/useWatch.js"],"sourcesContent":["import warning from \"@rc-component/util/es/warning\";\nimport { useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport FieldContext, { HOOK_MARK } from \"./FieldContext\";\nimport { isFormInstance } from \"./utils/typeUtil\";\nimport { getNamePath, getValue } from \"./utils/valueUtil\";\nimport { useEvent } from '@rc-component/util';\nexport function stringify(value) {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return Math.random();\n  }\n}\n\n// ------- selector type -------\n\n// ------- selector type end -------\n\nfunction useWatch(...args) {\n  const [dependencies, _form = {}] = args;\n  const options = isFormInstance(_form) ? {\n    form: _form\n  } : _form;\n  const form = options.form;\n  const [value, setValue] = useState(() => typeof dependencies === 'function' ? dependencies({}) : undefined);\n  const valueStr = useMemo(() => stringify(value), [value]);\n  const valueStrRef = useRef(valueStr);\n  valueStrRef.current = valueStr;\n  const fieldContext = useContext(FieldContext);\n  const formInstance = form || fieldContext;\n  const isValidForm = formInstance && formInstance._init;\n\n  // Warning if not exist form instance\n  if (process.env.NODE_ENV !== 'production') {\n    warning(args.length === 2 ? form ? isValidForm : true : isValidForm, 'useWatch requires a form instance since it can not auto detect from context.');\n  }\n\n  // ============================== Form ==============================\n  const {\n    getFieldsValue,\n    getInternalHooks\n  } = formInstance;\n  const {\n    registerWatch\n  } = getInternalHooks(HOOK_MARK);\n\n  // ============================= Update =============================\n  const triggerUpdate = useEvent((values, allValues) => {\n    const watchValue = options.preserve ? allValues ?? getFieldsValue(true) : values ?? getFieldsValue();\n    const nextValue = typeof dependencies === 'function' ? dependencies(watchValue) : getValue(watchValue, getNamePath(dependencies));\n    if (stringify(value) !== stringify(nextValue)) {\n      setValue(nextValue);\n    }\n  });\n\n  // ============================= Effect =============================\n  const flattenDeps = typeof dependencies === 'function' ? dependencies : JSON.stringify(dependencies);\n\n  // Deps changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    triggerUpdate();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm, flattenDeps]);\n\n  // Value changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    const cancelRegister = registerWatch((values, allValues) => {\n      triggerUpdate(values, allValues);\n    });\n    return cancelRegister;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm]);\n  return value;\n}\nexport default useWatch;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}