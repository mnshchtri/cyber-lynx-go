{"ast":null,"code":"import { warning } from \"@rc-component/util/es/warning\";\nimport { useEffect, useRef, useState } from 'react';\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"../previewConfig\";\nexport default function useMouseEvent(imgRef, movable, open, scaleStep, transform, updateTransform, dispatchZoomChange) {\n  const {\n    rotate,\n    scale,\n    x,\n    y\n  } = transform;\n  const [isMoving, setMoving] = useState(false);\n  const startPositionInfo = useRef({\n    diffX: 0,\n    diffY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n  const onMouseDown = event => {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    startPositionInfo.current = {\n      diffX: event.pageX - x,\n      diffY: event.pageY - y,\n      transformX: x,\n      transformY: y\n    };\n    setMoving(true);\n  };\n  const onMouseMove = event => {\n    if (open && isMoving) {\n      updateTransform({\n        x: event.pageX - startPositionInfo.current.diffX,\n        y: event.pageY - startPositionInfo.current.diffY\n      }, 'move');\n    }\n  };\n  const onMouseUp = () => {\n    if (open && isMoving) {\n      setMoving(false);\n\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n      const {\n        transformX,\n        transformY\n      } = startPositionInfo.current;\n      const hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) return;\n      const width = imgRef.current.offsetWidth * scale;\n      const height = imgRef.current.offsetHeight * scale;\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      const {\n        left,\n        top\n      } = imgRef.current.getBoundingClientRect();\n      const isRotate = rotate % 180 !== 0;\n      const fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n      if (fixState) {\n        updateTransform({\n          ...fixState\n        }, 'dragRebound');\n      }\n    }\n  };\n  const onWheel = event => {\n    if (!open || event.deltaY == 0) return;\n    // Scale ratio depends on the deltaY size\n    const scaleRatio = Math.abs(event.deltaY / 100);\n    // Limit the maximum scale ratio\n    const mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO);\n    // Scale the ratio each time\n    let ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n  useEffect(() => {\n    if (movable) {\n      window.addEventListener('mouseup', onMouseUp, false);\n      window.addEventListener('mousemove', onMouseMove, false);\n      try {\n        // Resolve if in iframe lost event\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          window.top.addEventListener('mouseup', onMouseUp, false);\n          window.top.addEventListener('mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, `[rc-image] ${error}`);\n      }\n    }\n    return () => {\n      window.removeEventListener('mouseup', onMouseUp);\n      window.removeEventListener('mousemove', onMouseMove);\n      // /* istanbul ignore next */\n      window.top?.removeEventListener('mouseup', onMouseUp);\n      // /* istanbul ignore next */\n      window.top?.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [open, isMoving, x, y, rotate, movable]);\n  return {\n    isMoving,\n    onMouseDown,\n    onMouseMove,\n    onMouseUp,\n    onWheel\n  };\n}","map":{"version":3,"names":["warning","useEffect","useRef","useState","getFixScaleEleTransPosition","BASE_SCALE_RATIO","WHEEL_MAX_SCALE_RATIO","useMouseEvent","imgRef","movable","open","scaleStep","transform","updateTransform","dispatchZoomChange","rotate","scale","x","y","isMoving","setMoving","startPositionInfo","diffX","diffY","transformX","transformY","onMouseDown","event","button","preventDefault","stopPropagation","current","pageX","pageY","onMouseMove","onMouseUp","hasChangedPosition","width","offsetWidth","height","offsetHeight","left","top","getBoundingClientRect","isRotate","fixState","onWheel","deltaY","scaleRatio","Math","abs","mergedScaleRatio","min","ratio","clientX","clientY","window","addEventListener","self","error","removeEventListener"],"sources":["/Users/mnsh/Desktop/cyber-lynx/Cyber-LynX-php/frontend/node_modules/@rc-component/image/es/hooks/useMouseEvent.js"],"sourcesContent":["import { warning } from \"@rc-component/util/es/warning\";\nimport { useEffect, useRef, useState } from 'react';\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"../previewConfig\";\nexport default function useMouseEvent(imgRef, movable, open, scaleStep, transform, updateTransform, dispatchZoomChange) {\n  const {\n    rotate,\n    scale,\n    x,\n    y\n  } = transform;\n  const [isMoving, setMoving] = useState(false);\n  const startPositionInfo = useRef({\n    diffX: 0,\n    diffY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n  const onMouseDown = event => {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    startPositionInfo.current = {\n      diffX: event.pageX - x,\n      diffY: event.pageY - y,\n      transformX: x,\n      transformY: y\n    };\n    setMoving(true);\n  };\n  const onMouseMove = event => {\n    if (open && isMoving) {\n      updateTransform({\n        x: event.pageX - startPositionInfo.current.diffX,\n        y: event.pageY - startPositionInfo.current.diffY\n      }, 'move');\n    }\n  };\n  const onMouseUp = () => {\n    if (open && isMoving) {\n      setMoving(false);\n\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n      const {\n        transformX,\n        transformY\n      } = startPositionInfo.current;\n      const hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) return;\n      const width = imgRef.current.offsetWidth * scale;\n      const height = imgRef.current.offsetHeight * scale;\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      const {\n        left,\n        top\n      } = imgRef.current.getBoundingClientRect();\n      const isRotate = rotate % 180 !== 0;\n      const fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n      if (fixState) {\n        updateTransform({\n          ...fixState\n        }, 'dragRebound');\n      }\n    }\n  };\n  const onWheel = event => {\n    if (!open || event.deltaY == 0) return;\n    // Scale ratio depends on the deltaY size\n    const scaleRatio = Math.abs(event.deltaY / 100);\n    // Limit the maximum scale ratio\n    const mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO);\n    // Scale the ratio each time\n    let ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n  useEffect(() => {\n    if (movable) {\n      window.addEventListener('mouseup', onMouseUp, false);\n      window.addEventListener('mousemove', onMouseMove, false);\n      try {\n        // Resolve if in iframe lost event\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          window.top.addEventListener('mouseup', onMouseUp, false);\n          window.top.addEventListener('mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, `[rc-image] ${error}`);\n      }\n    }\n    return () => {\n      window.removeEventListener('mouseup', onMouseUp);\n      window.removeEventListener('mousemove', onMouseMove);\n      // /* istanbul ignore next */\n      window.top?.removeEventListener('mouseup', onMouseUp);\n      // /* istanbul ignore next */\n      window.top?.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [open, isMoving, x, y, rotate, movable]);\n  return {\n    isMoving,\n    onMouseDown,\n    onMouseMove,\n    onMouseUp,\n    onWheel\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}